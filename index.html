<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Slovenia 2025 Interactive Itinerary</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        height: 100vh;
        overflow: hidden;
      }

      .container {
        display: flex;
        height: 100vh;
        background: white;
        margin: 10px;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .sidebar {
        width: 400px;
        background: #f8f9fa;
        border-right: 1px solid #e9ecef;
        overflow-y: auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid #e9ecef;
      }

      .header h1 {
        color: #2c3e50;
        font-size: 24px;
        margin-bottom: 5px;
      }

      .header p {
        color: #7f8c8d;
        font-size: 14px;
      }

      .day-card {
        background: white;
        border-radius: 12px;
        margin-bottom: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: pointer;
        border-left: 5px solid;
      }

      .day-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
      }

      .day-header {
        padding: 15px 20px 10px;
        border-bottom: 1px solid #f1f3f4;
      }

      .day-title {
        font-weight: bold;
        font-size: 16px;
        color: #2c3e50;
        margin-bottom: 5px;
      }

      .day-date {
        font-size: 12px;
        color: #7f8c8d;
      }

      .locations {
        padding: 10px 20px 15px;
      }

      .location {
        margin-bottom: 8px;
        font-size: 13px;
        color: #495057;
        border-radius: 8px;
        transition: all 0.2s ease;
      }

      .location-header {
        display: flex;
        align-items: center;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        transition: background-color 0.2s ease;
      }

      .location-header:hover {
        background-color: #f8f9fa;
      }

      .location-icon {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-right: 10px;
        flex-shrink: 0;
      }

      .location-main {
        flex: 1;
      }

      .location-expand-btn {
        background: none;
        border: none;
        color: #6c757d;
        font-size: 12px;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
        margin-left: 8px;
      }

      .location-expand-btn:hover {
        background-color: #e9ecef;
        color: #495057;
      }

      .location-details {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background-color: #f8f9fa;
        margin: 4px 0 0 0;
        border-radius: 0 0 8px 8px;
      }

      .location-details.expanded {
        max-height: 300px;
      }

      .location-details-content {
        padding: 12px 16px;
        border-top: 1px solid #e9ecef;
      }

      .detail-item {
        margin-bottom: 8px;
        font-size: 12px;
        line-height: 1.4;
      }

      .detail-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 2px;
      }

      .detail-value {
        color: #6c757d;
      }

      .time-badge {
        display: inline-block;
        background: #e3f2fd;
        color: #1976d2;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 500;
        margin-bottom: 8px;
      }

      .tip-icon {
        color: #ffc107;
        margin-right: 4px;
      }

      .parking-icon {
        color: #17a2b8;
        margin-right: 4px;
      }

      .cash-icon {
        color: #28a745;
        margin-right: 4px;
      }

      .hotel {
        background: #f8f9fa;
        border-left: 3px solid #6c757d;
        padding: 8px 12px;
        margin-top: 8px;
        border-radius: 0 8px 8px 0;
        font-size: 12px;
        color: #495057;
      }

      .map-container {
        flex: 1;
        position: relative;
      }

      #map {
        width: 100%;
        height: 100%;
      }

      .legend {
        position: absolute;
        bottom: 20px;
        right: 20px;
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        max-height: 300px;
        overflow-y: auto;
        min-width: 200px;
      }

      .legend h3 {
        margin-bottom: 10px;
        font-size: 14px;
        color: #2c3e50;
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        font-size: 12px;
      }

      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-right: 8px;
        border: 2px solid white;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2);
      }

      .active-day {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
      }

      .popup-content {
        font-size: 13px;
        line-height: 1.4;
        min-width: 150px;
      }

      .popup-title {
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 5px;
        font-size: 14px;
      }

      .popup-activities {
        color: #495057;
        font-size: 12px;
      }

      .google-maps-btn {
        background: #ffffff;
        color: #1976d2;
        border: 2px solid #1976d2;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 8px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        text-decoration: none;
        transition: all 0.2s ease;
        min-height: 28px;
      }

      .google-maps-btn:hover {
        background: #1976d2;
        color: white;
        text-decoration: none;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(25, 118, 210, 0.3);
      }

      .google-maps-btn:active {
        background: #1565c0;
        color: white;
        transform: translateY(0);
      }

      .google-maps-icon {
        font-size: 12px;
      }

      .controls {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }

      .control-btn {
        background: white;
        border: none;
        padding: 10px 15px;
        margin-left: 5px;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        font-size: 12px;
        transition: all 0.2s ease;
      }

      .control-btn:hover {
        background: #f8f9fa;
        transform: translateY(-1px);
      }

      .control-btn.active {
        background: #007bff;
        color: white;
      }

      /* Ensure popups are visible and styled nicely */
      .leaflet-popup-content-wrapper {
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .leaflet-popup-content {
        margin: 8px 12px;
      }

      /* Make markers more interactive */
      .leaflet-interactive {
        cursor: pointer !important;
      }

      /* Legend Toggle Button for Mobile */
      .legend-toggle {
        display: none;
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1001;
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
      }

      .legend-toggle:hover {
        background: #0056b3;
        transform: translateY(-1px);
      }

      .legend-toggle.active {
        background: #28a745;
      }

      /* Mobile Responsive Styles */
      @media (max-width: 768px) {
        body {
          overflow: hidden;
        }

        .container {
          flex-direction: column;
          height: 100vh;
          margin: 0;
          border-radius: 0;
        }

        .map-container {
          height: 50vh;
          min-height: 300px;
          flex: none;
          order: 1;
        }

        .sidebar {
          width: 100%;
          height: 50vh;
          position: relative;
          border-right: none;
          border-top: 1px solid #e9ecef;
          border-bottom: none;
          padding: 15px;
          order: 2;
          transform: none;
          transition: none;
          overflow-y: auto;
        }

        .mobile-toggle {
          display: none;
        }

        .header h1 {
          font-size: 20px;
        }

        .header p {
          font-size: 12px;
        }

        .day-card {
          margin-bottom: 10px;
        }

        .day-header {
          padding: 12px 15px 8px;
        }

        .day-title {
          font-size: 14px;
        }

        .day-date {
          font-size: 11px;
        }

        .locations {
          padding: 8px 15px 12px;
        }

        .location {
          font-size: 12px;
          margin-bottom: 6px;
        }

        .location-header {
          padding: 6px;
        }

        .location-icon {
          width: 14px;
          height: 14px;
          margin-right: 8px;
        }

        .location-expand-btn {
          font-size: 11px;
          padding: 3px;
        }

        .location-details-content {
          padding: 10px 12px;
        }

        .detail-item {
          margin-bottom: 6px;
          font-size: 11px;
        }

        .time-badge {
          font-size: 10px;
          padding: 1px 6px;
        }

        .hotel {
          font-size: 11px;
          padding: 6px 10px;
          margin-top: 6px;
        }

        .controls {
          top: 10px;
          right: 10px;
          display: flex;
          flex-wrap: wrap;
          gap: 5px;
        }

        .control-btn {
          padding: 8px 12px;
          font-size: 11px;
          margin-left: 0;
        }

        .legend {
          bottom: 10px;
          right: 10px;
          left: 10px;
          max-height: 150px;
          padding: 10px;
          min-width: auto;
          display: none;
          transition: all 0.3s ease;
        }

        .legend.mobile-visible {
          display: block;
        }

        .legend-toggle {
          display: block;
        }

        .legend h3 {
          font-size: 12px;
          margin-bottom: 8px;
        }

        .legend-item {
          font-size: 10px;
          margin-bottom: 6px;
        }

        .legend-color {
          width: 12px;
          height: 12px;
          margin-right: 6px;
        }

        /* Improve popup readability on mobile */
        .leaflet-popup-content-wrapper {
          max-width: 250px;
        }

        .popup-content {
          font-size: 12px;
        }

        .popup-title {
          font-size: 13px;
        }

        .popup-activities {
          font-size: 11px;
        }

        .google-maps-btn {
          padding: 8px 12px;
          font-size: 12px;
          min-height: 32px;
          margin-top: 6px;
        }

        .google-maps-icon {
          font-size: 13px;
        }
      }

      /* Tablet Styles */
      @media (min-width: 769px) and (max-width: 1024px) {
        .sidebar {
          width: 350px;
          padding: 18px;
        }

        .header h1 {
          font-size: 22px;
        }

        .day-title {
          font-size: 15px;
        }

        .controls {
          top: 15px;
          right: 15px;
        }

        .legend {
          bottom: 15px;
          right: 15px;
          min-width: 180px;
        }
      }

      /* Large Screen Optimizations */
      @media (min-width: 1400px) {
        .sidebar {
          width: 450px;
          padding: 25px;
        }

        .header h1 {
          font-size: 26px;
        }

        .day-title {
          font-size: 17px;
        }

        .location {
          font-size: 14px;
        }
      }
    </style>

    <script>
      const files = {};

      window.fs = {};
      window.fs.readFile = (fileName) => {
        // return array buffer
        return new Promise((resolve) => {
          const content = files[fileName];
          const decoded = atob(content);
          const arr = new Uint8Array(decoded.length);
          for (let i = 0; i < decoded.length; i++) {
            arr[i] = decoded.charCodeAt(i);
          }
          resolve(arr);
        });
      };
    </script>
  </head>
  <body>
    <div class="container">
      <div class="sidebar" id="sidebar">
        <div class="header">
          <h1>üá∏üáÆ Slovenia 2025</h1>
          <p>13-Day Adventure ‚Ä¢ Aug 29 - Sep 10</p>
        </div>
        <div id="itinerary"></div>
      </div>

      <div class="map-container">
        <button class="legend-toggle" id="legendToggle">üìç Legend</button>
        <div class="controls">
          <button class="control-btn active" onclick="showAllDays()">
            Show All
          </button>
        </div>
        <div id="map"></div>
        <div class="legend" id="legend">
          <h3>Days Legend</h3>
          <div id="legend-content"></div>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      // Color palette for different days
      const dayColors = [
        "#FF6B6B",
        "#4ECDC4",
        "#45B7D1",
        "#96CEB4",
        "#FECA57",
        "#FF9FF3",
        "#54A0FF",
        "#5F27CD",
        "#00D2D3",
        "#FF9F43",
        "#EE5A24",
        "#0984E3",
        "#74B9FF",
      ];

      // Hotel locations data
      const hotelLocations = {
        "Villa Mukinja, Plitvice": { lat: 44.8654, lng: 15.582 },
        "Hotel Hom at Vintgar": { lat: 46.3683, lng: 14.094 },
        "Rustic House 13 Studor v Bohinju": { lat: 46.2833, lng: 13.8333 },
        "Koƒça pri Triglavskih jezerih (Mountain Hut)": {
          lat: 46.3333,
          lng: 13.8833,
        },
        "Vivo Bovec": { lat: 46.3383, lng: 13.5536 },
        "Odisej House Tolmin": { lat: 46.1833, lng: 13.7333 },
        "Four Points by Sheraton Ljubljana Mons": {
          lat: 46.0569,
          lng: 14.5058,
        },
        "Blue Waves Resort, Krk": { lat: 45.0278, lng: 14.5722 },
      };

      // Itinerary data (updated with correct Blue Waves Resort location in Krk)
      const itinerary = [
        {
          day: 1,
          date: "Aug 29 (Fri)",
          title: "‚úàÔ∏è Arrival",
          locations: [
            {
              name: "Zagreb Airport",
              lat: 45.7429,
              lng: 16.0688,
              activities: ["Arrive ~12 pm"],
              timeNeeded: "30 min",
              touristTips:
                "Free WiFi available. Currency exchange at arrivals. Car rental desks on ground floor.",
              parking: "Short-term parking: ‚Ç¨2/hour, Long-term: ‚Ç¨8/day",
              cashNeeded: "No - cards accepted everywhere",
            },
            {
              name: "Lotr≈°ƒçak Tower",
              lat: 45.815,
              lng: 15.9819,
              activities: ["Sightseeing"],
              timeNeeded: "45 min",
              touristTips:
                "Cannon fires daily at noon. Great views of Zagreb. Climb 13th-century tower.",
              parking: "Limited street parking nearby - use public transport",
              cashNeeded: "Entry: ‚Ç¨3 (cash preferred)",
            },
            {
              name: "Tkalƒçiƒáeva Street",
              lat: 45.8144,
              lng: 15.9798,
              activities: ["Caf√© visit"],
              timeNeeded: "1-2 hours",
              touristTips:
                "Pedestrian street with caf√©s and restaurants. Try local coffee culture.",
              parking: "No parking - pedestrian zone",
              cashNeeded: "Cards accepted, but small tips in cash appreciated",
            },
            {
              name: "Plitvice Lakes",
              lat: 44.8654,
              lng: 15.582,
              activities: ["Drive (~2.5 hrs)"],
              timeNeeded: "2.5 hours drive",
              touristTips:
                "Scenic route through Croatian countryside. Stop for snacks in Karlovac.",
              parking: "Hotel parking available",
              cashNeeded: "Tolls: ‚Ç¨5-8 (cash or card)",
            },
          ],
          hotel: "Villa Mukinja, Plitvice",
        },
        {
          day: 2,
          date: "Aug 30 (Sat)",
          title: "üí¶ Waterfall Hike! Plitvice ‚Üí Lake Bled",
          locations: [
            {
              name: "Plitvice Route C",
              lat: 44.8654,
              lng: 15.582,
              activities: ["Hiking trail"],
              timeNeeded: "4-6 hours",
              touristTips:
                "Start early (8am) to avoid crowds. Wear comfortable hiking shoes. Bring water and snacks.",
              parking: "Park entrance: ‚Ç¨8/day. Arrive early for spots.",
              cashNeeded: "Entry: ‚Ç¨40 (peak season) - cards accepted",
            },
            {
              name: "Lake Bled",
              lat: 46.3683,
              lng: 14.094,
              activities: ["Drive to Bled"],
              timeNeeded: "3.5 hours drive",
              touristTips:
                "Scenic drive through Slovenia. Stop in Ljubljana for lunch if time permits.",
              parking: "Hotel parking available",
              cashNeeded: "Tolls: ‚Ç¨3-5 (cash or card)",
            },
          ],
          hotel: "Hotel Hom at Vintgar",
        },
        {
          day: 3,
          date: "Aug 31 (Sun)",
          title: "üö£ Bled",
          locations: [
            {
              name: "Ojstrica Viewpoint",
              lat: 46.3647,
              lng: 14.0758,
              activities: ["Hike (45 min total)"],
              timeNeeded: "45 min",
              touristTips:
                "Best sunrise/sunset views of Lake Bled. Steep but short hike. Bring camera!",
              parking: "Small parking area - arrive early",
              cashNeeded: "Free",
            },
            {
              name: "Bled Island",
              lat: 46.3677,
              lng: 14.1028,
              activities: ["Island & church visit"],
              timeNeeded: "1.5 hours",
              touristTips:
                "Traditional pletna boat ride. Ring church bell for good luck. Book boat in advance.",
              parking: "Use lakeside parking areas",
              cashNeeded: "Pletna boat: ‚Ç¨18/person (cash preferred)",
            },
            {
              name: "Bled Castle",
              lat: 46.3717,
              lng: 14.099,
              activities: ["Castle visit"],
              timeNeeded: "1-2 hours",
              touristTips:
                "Medieval castle with museum. Try castle wine. Great views over lake.",
              parking: "Castle parking: ‚Ç¨2/hour",
              cashNeeded: "Entry: ‚Ç¨13 (cards accepted)",
            },
            {
              name: "Vintgar Gorge",
              lat: 46.3833,
              lng: 14.0833,
              activities: ["Loop hike (~1.5 hrs)"],
              timeNeeded: "1.5 hours",
              touristTips:
                "Wooden walkways over emerald river. Can get crowded - go early or late.",
              parking: "Gorge parking: ‚Ç¨5/day",
              cashNeeded: "Entry: ‚Ç¨10 (cash or card)",
            },
          ],
          hotel: "Hotel Hom at Vintgar",
        },
        {
          day: 4,
          date: "Sept 1 (Mon)",
          title: "üö∂ Bohinj",
          locations: [
            {
              name: "Mostnica Gorge",
              lat: 46.2833,
              lng: 13.85,
              activities: ["Hike (~2 hrs)"],
              timeNeeded: "2 hours",
              touristTips:
                "Beautiful gorge with natural pools. Less crowded than Vintgar. Wear good shoes.",
              parking: "Free parking at trailhead",
              cashNeeded: "Free",
            },
            {
              name: "Lake Bohinj",
              lat: 46.2833,
              lng: 13.8333,
              activities: ["Swimming"],
              timeNeeded: "2-3 hours",
              touristTips:
                "Larger, quieter lake than Bled. Swimming allowed. Rent kayaks or SUP boards.",
              parking: "Lakeside parking: ‚Ç¨1.50/hour",
              cashNeeded: "Parking coins needed, activities cash/card",
            },
            {
              name: "Savica Waterfall",
              lat: 46.3,
              lng: 13.8167,
              activities: ["Hike (45 min)"],
              timeNeeded: "45 min",
              touristTips:
                "78m waterfall, source of Sava River. Uphill hike but worth it. Bring water.",
              parking: "Parking: ‚Ç¨3/day",
              cashNeeded: "Entry: ‚Ç¨4 (cash preferred)",
            },
            {
              name: "Vogel Cable Car",
              lat: 46.2667,
              lng: 13.8333,
              activities: ["Julian Alps panorama (~1.5‚Äì2 hrs)"],
              timeNeeded: "2 hours",
              touristTips:
                "Stunning 360¬∞ mountain views. Check weather conditions. Restaurant at top.",
              parking: "Cable car parking: ‚Ç¨3/day",
              cashNeeded: "Cable car: ‚Ç¨22 return (cards accepted)",
            },
          ],
          hotel: "Rustic House 13 Studor v Bohinju",
        },
        {
          day: 5,
          date: "Sept 2 (Tue)",
          title: "‚õ∞Ô∏è Start Seven Lakes Loop",
          locations: [
            {
              name: "Planina Blato",
              lat: 46.3167,
              lng: 13.85,
              activities: ["Trailhead"],
              timeNeeded: "30 min",
              touristTips:
                "Starting point for Seven Lakes hike. Check weather conditions. Bring mountain gear.",
              parking: "Free parking at trailhead",
              cashNeeded: "Free",
            },
            {
              name: "Planina pri Jezeru",
              lat: 46.3,
              lng: 13.8667,
              activities: ["Hiking waypoint"],
              timeNeeded: "2 hours hike",
              touristTips:
                "Beautiful alpine meadow. Good rest stop. Fill water bottles at mountain springs.",
              parking: "N/A - hiking trail",
              cashNeeded: "Free",
            },
            {
              name: "Koƒça pri Triglavskih jezerih",
              lat: 46.3333,
              lng: 13.8833,
              activities: ["Lunch, overnight in hut"],
              timeNeeded: "Overnight",
              touristTips:
                "Mountain hut with basic accommodation. Book in advance. Bring sleeping bag liner.",
              parking: "N/A - hiking trail",
              cashNeeded: "Hut fee: ‚Ç¨25-35/night + meals (cash only)",
            },
            {
              name: "Hribarice Plateau",
              lat: 46.34,
              lng: 13.89,
              activities: ["Optional hike"],
              timeNeeded: "1 hour",
              touristTips:
                "Optional side trip for views. Weather dependent. Return to hut before dark.",
              parking: "N/A - hiking trail",
              cashNeeded: "Free",
            },
          ],
          hotel: "Koƒça pri Triglavskih jezerih (Mountain Hut)",
        },
        {
          day: 6,
          date: "Sept 3 (Wed)",
          title: "‚õ∞Ô∏è Finish Seven Lakes",
          locations: [
            {
              name: "≈†tapce Pass",
              lat: 46.35,
              lng: 13.9,
              activities: ["Hiking waypoint"],
              timeNeeded: "1.5 hours hike",
              touristTips:
                "High mountain pass. Can be windy and cold. Layer clothing appropriately.",
              parking: "N/A - hiking trail",
              cashNeeded: "Free",
            },
            {
              name: "Black Lake",
              lat: 46.36,
              lng: 13.91,
              activities: ["Seven Lakes trail"],
              timeNeeded: "2 hours",
              touristTips:
                "Largest of the seven lakes. Great photo opportunities. Swimming possible but cold!",
              parking: "N/A - hiking trail",
              cashNeeded: "Free",
            },
            {
              name: "Planina Vi≈°evnik",
              lat: 46.37,
              lng: 13.92,
              activities: ["Hiking waypoint"],
              timeNeeded: "1 hour",
              touristTips:
                "Final descent point. Check trail conditions. Steep sections require care.",
              parking: "N/A - hiking trail",
              cashNeeded: "Free",
            },
            {
              name: "Vr≈°iƒç Pass",
              lat: 46.4333,
              lng: 13.75,
              activities: ["Drive (~2 hrs)", "Summit viewpoint"],
              timeNeeded: "1 hour + drive",
              touristTips:
                "Highest mountain pass in Slovenia. 50 hairpin turns. Stop at viewpoints.",
              parking: "Free roadside parking",
              cashNeeded: "Free",
            },
            {
              name: "Lake Jasna",
              lat: 46.4833,
              lng: 13.7333,
              activities: ["Scenic stop"],
              timeNeeded: "30 min",
              touristTips:
                "Artificial lake with mountain reflections. Popular photo spot. Short walk around lake.",
              parking: "Free parking area",
              cashNeeded: "Free",
            },
            {
              name: "Russian Chapel",
              lat: 46.4167,
              lng: 13.7667,
              activities: ["Historical site"],
              timeNeeded: "20 min",
              touristTips:
                "Memorial to Russian POWs who died building the road. Small but moving historical site.",
              parking: "Roadside parking",
              cashNeeded: "Free",
            },
          ],
          hotel: "Vivo Bovec",
        },
        {
          day: 7,
          date: "Sept 4 (Thu)",
          title: "üåä Soƒça River Fun",
          locations: [
            {
              name: "Bovec",
              lat: 46.3383,
              lng: 13.5536,
              activities: ["Rafting (8:15 - 3 hrs)"],
              timeNeeded: "3 hours",
              touristTips:
                "Emerald river rafting. Bring swimwear, towel. Waterproof camera recommended.",
              parking: "Rafting company provides parking",
              cashNeeded: "Rafting: ‚Ç¨35-50 (book online, pay cash/card)",
            },
            {
              name: "Virje Waterfall",
              lat: 46.3167,
              lng: 13.5833,
              activities: ["Quick stop (10 min drive)"],
              timeNeeded: "20 min",
              touristTips:
                "Easy access waterfall. Good for photos. Can get crowded in afternoon.",
              parking: "Small parking area",
              cashNeeded: "Free",
            },
            {
              name: "Great Soƒça Gorge",
              lat: 46.3,
              lng: 13.6,
              activities: ["30 min wander (15 min drive)"],
              timeNeeded: "30 min",
              touristTips:
                "Dramatic gorge with turquoise water. Short walk from parking. Mind the edges!",
              parking: "Free parking",
              cashNeeded: "Free",
            },
            {
              name: "Boka Waterfall",
              lat: 46.2833,
              lng: 13.6167,
              activities: ["Optional stop (10 min drive)"],
              timeNeeded: "30 min",
              touristTips:
                "Slovenia's highest waterfall (144m). Best viewed from distance. Short walk from road.",
              parking: "Roadside parking",
              cashNeeded: "Free",
            },
            {
              name: "Kozjak Waterfall",
              lat: 46.25,
              lng: 13.65,
              activities: ["1‚Äì1.5 hr hike (25 min drive)"],
              timeNeeded: "1.5 hours",
              touristTips:
                "Hidden waterfall in cave-like setting. Moderate hike through forest. Bring flashlight.",
              parking: "Free parking at trailhead",
              cashNeeded: "Free",
            },
            {
              name: "Napoleon Bridge",
              lat: 46.3383,
              lng: 13.5536,
              activities: ["Quick stop in town"],
              timeNeeded: "15 min",
              touristTips:
                "Historic stone bridge over Soƒça River. Good for photos. In Bovec town center.",
              parking: "Town parking available",
              cashNeeded: "Free",
            },
          ],
          hotel: "Odisej House Tolmin",
        },
        {
          day: 8,
          date: "Sept 5 (Fri)",
          title: "üè∞ Tolmin, Postojna & Predjama ‚Üí Ljubljana",
          locations: [
            {
              name: "Tolmin Gorge",
              lat: 46.1833,
              lng: 13.7333,
              activities: ["Morning hike (1‚Äì1.5 hrs)"],
              timeNeeded: "1.5 hours",
              touristTips:
                "Deepest gorge in Slovenia. Wooden walkways and bridges. Start early to avoid crowds.",
              parking: "Parking: ‚Ç¨3/day",
              cashNeeded: "Entry: ‚Ç¨6 (cash or card)",
            },
            {
              name: "Postojna Cave",
              lat: 45.7833,
              lng: 14.2,
              activities: ["Cave tour (1.5‚Äì2 hrs)"],
              timeNeeded: "2 hours",
              touristTips:
                "Famous cave system with train ride. Book online in advance. Bring jacket (9¬∞C inside).",
              parking: "Free parking at visitor center",
              cashNeeded: "Entry: ‚Ç¨29 (online booking recommended)",
            },
            {
              name: "Predjama Castle",
              lat: 45.8147,
              lng: 14.1275,
              activities: ["Castle visit (1‚Äì1.5 hrs)"],
              timeNeeded: "1.5 hours",
              touristTips:
                "Castle built into cliff face. Combine ticket with Postojna Cave available. Audio guide included.",
              parking: "Free parking",
              cashNeeded: "Entry: ‚Ç¨16 or combo ticket ‚Ç¨37 (cards accepted)",
            },
            {
              name: "Ljubljana",
              lat: 46.0569,
              lng: 14.5058,
              activities: ["Arrive in capital"],
              timeNeeded: "1 hour drive",
              touristTips:
                "Slovenia's charming capital. Park outside center and walk. Evening stroll recommended.",
              parking: "Hotel parking or public garages ‚Ç¨1-2/hour",
              cashNeeded: "Parking meters require coins",
            },
          ],
          hotel: "Four Points by Sheraton Ljubljana Mons",
        },
        {
          day: 9,
          date: "Sept 6 (Sat)",
          title: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Ljubljana - Family Day",
          locations: [
            {
              name: "Ljubljana",
              lat: 46.0569,
              lng: 14.5058,
              activities: ["Meet Tanja's family"],
              timeNeeded: "Full day",
              touristTips:
                "Relaxed family day. Explore local recommendations. Try traditional Slovenian cuisine.",
              parking: "Hotel parking or city center garages",
              cashNeeded: "Restaurants accept cards, small tips in cash",
            },
          ],
          hotel: "Four Points by Sheraton Ljubljana Mons",
        },
        {
          day: 10,
          date: "Sept 7 (Sun)",
          title: "üèõÔ∏è Ljubljana Exploration",
          locations: [
            {
              name: "Ljubljana Castle",
              lat: 46.0492,
              lng: 14.5073,
              activities: ["Castle & funicular"],
              timeNeeded: "2 hours",
              touristTips:
                "Take funicular up, walk down. Great city views. Museum and exhibitions inside.",
              parking: "Use city center parking, walk to funicular",
              cashNeeded: "Castle + funicular: ‚Ç¨13 (cards accepted)",
            },
            {
              name: "Central Market",
              lat: 46.0514,
              lng: 14.5061,
              activities: ["Market visit"],
              timeNeeded: "1 hour",
              touristTips:
                "Open Mon-Sat. Fresh produce, local crafts. Try local honey and cheese.",
              parking: "Nearby parking garages",
              cashNeeded: "Small purchases - cash preferred",
            },
            {
              name: "Tivoli Park",
              lat: 46.0556,
              lng: 14.4931,
              activities: ["Park walk"],
              timeNeeded: "1-2 hours",
              touristTips:
                "Largest park in Ljubljana. Great for jogging or relaxing. Visit Tivoli Mansion.",
              parking: "Park entrances have nearby parking",
              cashNeeded: "Free",
            },
            {
              name: "Pre≈°eren Square",
              lat: 46.0514,
              lng: 14.5047,
              activities: ["City center"],
              timeNeeded: "30 min",
              touristTips:
                "Main square with pink church. Street performers often present. Caf√© culture.",
              parking: "Underground parking available",
              cashNeeded: "Free to visit, caf√©s accept cards",
            },
            {
              name: "Dragon Bridge",
              lat: 46.0522,
              lng: 14.5089,
              activities: ["Iconic bridge"],
              timeNeeded: "15 min",
              touristTips:
                "Art Nouveau bridge with dragon statues. Symbol of Ljubljana. Great for photos.",
              parking: "Walk from city center",
              cashNeeded: "Free",
            },
          ],
          hotel: "Four Points by Sheraton Ljubljana Mons",
        },
        {
          day: 11,
          date: "Sept 8 (Mon)",
          title: "üï≥Ô∏è Ljubljana ‚Üí Krk",
          locations: [
            {
              name: "≈†kocjan Caves",
              lat: 45.6667,
              lng: 14.0,
              activities: ["Cave tour (2 hrs)"],
              timeNeeded: "2.5 hours",
              touristTips:
                "UNESCO World Heritage site. Underground canyon. Book online. Bring warm clothes.",
              parking: "Free parking at visitor center",
              cashNeeded: "Entry: ‚Ç¨25 (online booking recommended)",
            },
            {
              name: "Krk",
              lat: 45.0278,
              lng: 14.5722,
              activities: ["Drive to Croatian island resort"],
              timeNeeded: "3 hours drive",
              touristTips:
                "Cross into Croatia - passport needed. Krk Bridge toll. Island connected by bridge.",
              parking: "Resort parking included",
              cashNeeded: "Bridge toll: ‚Ç¨5, Croatian kuna or euros accepted",
            },
          ],
          hotel: "Blue Waves Resort, Krk",
        },
        {
          day: 12,
          date: "Sept 9 (Tue)",
          title: "üèñÔ∏è Resort Relaxation",
          locations: [
            {
              name: "Krk",
              lat: 45.0278,
              lng: 14.5722,
              activities: ["Resort time", "Beach relaxation"],
              timeNeeded: "Full day",
              touristTips:
                "All-inclusive resort. Private beach access. Water sports available. Spa treatments.",
              parking: "Resort parking included",
              cashNeeded: "Resort is all-inclusive, tips in cash appreciated",
            },
          ],
          hotel: "Blue Waves Resort, Krk",
        },
        {
          day: 13,
          date: "Sept 10 (Wed)",
          title: "‚úàÔ∏è Departure",
          locations: [
            {
              name: "Zagreb Airport",
              lat: 45.7429,
              lng: 16.0688,
              activities: ["Early drive", "Return car & check in"],
              timeNeeded: "3 hours drive + airport time",
              touristTips:
                "Leave early for 3-hour drive. Return rental car. Check-in 2 hours before flight.",
              parking: "Rental car return area",
              cashNeeded: "Tolls: ‚Ç¨8-12, airport food/shopping accepts cards",
            },
          ],
          hotel: "Flight home",
        },
      ];

      // Initialize map
      const map = L.map("map").setView([45.8, 14.5], 7);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "¬© OpenStreetMap contributors",
      }).addTo(map);

      // Store markers and circles for each day
      const dayMarkers = {};
      const dayCircles = {};
      const hotelMarkers = [];
      let allMarkers = [];
      let currentFocusedDay = null;

      // Function to focus on a specific location
      function focusLocation(lat, lng, locationName) {
        map.setView([lat, lng], 14);

        // Find and open popup for this location if it exists
        allMarkers.forEach((marker) => {
          const markerLatLng = marker.getLatLng();
          if (
            Math.abs(markerLatLng.lat - lat) < 0.001 &&
            Math.abs(markerLatLng.lng - lng) < 0.001
          ) {
            marker.openPopup();
          }
        });
      }

      // Function to toggle location details
      function toggleLocationDetails(dayIndex, locationIndex) {
        const detailsId = `details-${dayIndex}-${locationIndex}`;
        const btnId = `btn-${dayIndex}-${locationIndex}`;

        const detailsElement = document.getElementById(detailsId);
        const btnElement = document.getElementById(btnId);

        if (detailsElement && btnElement) {
          const isExpanded = detailsElement.classList.contains("expanded");

          if (isExpanded) {
            detailsElement.classList.remove("expanded");
            btnElement.textContent = "‚ñº";
            btnElement.title = "Show details";
          } else {
            detailsElement.classList.add("expanded");
            btnElement.textContent = "‚ñ≤";
            btnElement.title = "Hide details";
          }
        }
      }

      // Create itinerary sidebar and map markers
      function createItinerary() {
        const itineraryContainer = document.getElementById("itinerary");
        const legendContainer = document.getElementById("legend-content");

        itinerary.forEach((day, index) => {
          const color = dayColors[index % dayColors.length];

          // Create day card
          const dayCard = document.createElement("div");
          dayCard.className = "day-card";
          dayCard.style.borderLeftColor = color;
          dayCard.onclick = () => focusDay(day.day);

          dayCard.innerHTML = `
                    <div class="day-header">
                        <div class="day-title">${day.title}</div>
                        <div class="day-date">Day ${day.day} - ${day.date}</div>
                    </div>
                    <div class="locations">
                        ${day.locations
                          .map(
                            (loc, locIndex) => `
                            <div class="location">
                                <div class="location-header" onclick="focusLocation(${
                                  loc.lat
                                }, ${loc.lng}, '${
                              loc.name
                            }'); event.stopPropagation();" style="cursor: pointer;">
                                    <div class="location-icon" style="background-color: ${color}"></div>
                                    <div class="location-main">
                                        <strong>${loc.name}</strong><br>
                                        <small>${loc.activities.join(
                                          ", "
                                        )}</small>
                                    </div>
                                    ${
                                      loc.timeNeeded
                                        ? `<button class="location-expand-btn" id="btn-${index}-${locIndex}" onclick="toggleLocationDetails(${index}, ${locIndex}); event.stopPropagation();" title="Show details">‚ñº</button>`
                                        : ""
                                    }
                                </div>
                                ${
                                  loc.timeNeeded
                                    ? `
                                <div class="location-details" id="details-${index}-${locIndex}">
                                    <div class="location-details-content">
                                        <div class="time-badge">‚è±Ô∏è ${loc.timeNeeded}</div>
                                        <div class="detail-item">
                                            <div class="detail-label"><span class="tip-icon">üí°</span>Tourist Tips</div>
                                            <div class="detail-value">${loc.touristTips}</div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-label"><span class="parking-icon">üÖøÔ∏è</span>Parking</div>
                                            <div class="detail-value">${loc.parking}</div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-label"><span class="cash-icon">üí∞</span>Cash Needed</div>
                                            <div class="detail-value">${loc.cashNeeded}</div>
                                        </div>
                                    </div>
                                </div>`
                                    : ""
                                }
                            </div>
                        `
                          )
                          .join("")}
                        <div class="hotel" onclick="focusLocation(${
                          hotelLocations[day.hotel]?.lat || 0
                        }, ${hotelLocations[day.hotel]?.lng || 0}, '${
            day.hotel
          }'); event.stopPropagation();" style="cursor: pointer;">üè® ${
            day.hotel
          }</div>
                    </div>
                `;

          itineraryContainer.appendChild(dayCard);

          // Create legend item
          const legendItem = document.createElement("div");
          legendItem.className = "legend-item";
          legendItem.innerHTML = `
                    <div class="legend-color" style="background-color: ${color}"></div>
                    <span>Day ${day.day} - ${day.date.split(" ")[0]}</span>
                `;
          legendContainer.appendChild(legendItem);

          // Create map markers and circle for this day
          const dayMarkersList = [];
          const latlngs = [];

          day.locations.forEach((location, locationIndex) => {
            // Create marker with unique properties
            const marker = L.circleMarker([location.lat, location.lng], {
              color: "white",
              fillColor: color,
              fillOpacity: 0.8,
              weight: 2,
              radius: 9,
              interactive: true, // Ensure marker is interactive
            }).addTo(map);

            // Create popup content - ensure it's not empty
            const activitiesText =
              location.activities && location.activities.length > 0
                ? location.activities.join("<br>")
                : "Visit location";

            const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
              location.name
            )}&center=${location.lat},${location.lng}`;

            const popupContent = `
                        <div class="popup-content">
                            <div class="popup-title">${
                              location.name || "Location"
                            }</div>
                            <div class="popup-activities">${activitiesText}</div>
                            <a href="${googleMapsUrl}" target="_blank" class="google-maps-btn" onclick="event.stopPropagation();">
                                <span class="google-maps-icon">üìç</span>
                                Open in Google Maps
                            </a>
                        </div>
                    `;

            // Bind popup with options
            marker.bindPopup(popupContent, {
              closeButton: true,
              autoClose: false,
              closeOnClick: false,
              className: "custom-popup",
            });

            // Add event listeners for hover and click
            marker.on("mouseover", function (e) {
              this.openPopup();
            });

            marker.on("click", function (e) {
              this.openPopup();
              e.originalEvent.stopPropagation();
            });

            // Optional: close on mouseout with delay
            marker.on("mouseout", function (e) {
              const popup = this;
              setTimeout(() => {
                if (!popup.isPopupOpen()) return;
                const popupElement = popup.getPopup()._container;
                if (popupElement && !popupElement.matches(":hover")) {
                  popup.closePopup();
                }
              }, 500);
            });

            // Store marker
            dayMarkersList.push(marker);
            allMarkers.push(marker);
            latlngs.push([location.lat, location.lng]);

            // Debug log to ensure all markers are created
            console.log(`Created marker for Day ${day.day}: ${location.name}`);
          });

          // Create circle around all locations for this day
          if (latlngs.length > 1) {
            const bounds = L.latLngBounds(latlngs);
            const center = bounds.getCenter();
            const maxDistance = Math.max(
              map.distance(center, bounds.getNorthEast()),
              map.distance(center, bounds.getSouthWest())
            );

            const circle = L.circle(center, {
              color: color,
              fillColor: color,
              fillOpacity: 0.1,
              weight: 2,
              radius: maxDistance * 1.2,
              interactive: false, // Circles shouldn't interfere with marker clicks
            }).addTo(map);

            dayCircles[day.day] = circle;
          }

          dayMarkers[day.day] = dayMarkersList;

          // Create hotel marker if hotel location exists
          if (hotelLocations[day.hotel]) {
            const hotelLoc = hotelLocations[day.hotel];

            // Create custom house icon
            const houseIcon = L.divIcon({
              html: '<div style="background: white; border: 2px solid #333; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px;">üè†</div>',
              className: "custom-house-icon",
              iconSize: [24, 24],
              iconAnchor: [12, 12],
            });

            const hotelMarker = L.marker([hotelLoc.lat, hotelLoc.lng], {
              icon: houseIcon,
              zIndexOffset: 1000, // Ensure hotels appear above other markers
            }).addTo(map);

            const hotelGoogleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
              day.hotel
            )}&center=${hotelLoc.lat},${hotelLoc.lng}`;

            const hotelPopupContent = `
              <div class="popup-content">
                <div class="popup-title">üè® ${day.hotel}</div>
                <div class="popup-activities">Day ${day.day} accommodation</div>
                <a href="${hotelGoogleMapsUrl}" target="_blank" class="google-maps-btn" onclick="event.stopPropagation();">
                    <span class="google-maps-icon">üìç</span>
                    Open in Google Maps
                </a>
              </div>
            `;

            hotelMarker.bindPopup(hotelPopupContent, {
              closeButton: true,
              autoClose: false,
              closeOnClick: false,
              className: "custom-popup",
            });

            hotelMarker.on("mouseover", function (e) {
              this.openPopup();
            });

            hotelMarker.on("click", function (e) {
              this.openPopup();
              e.originalEvent.stopPropagation();
            });

            hotelMarkers.push(hotelMarker);
          }
        });

        // Final debug log
        console.log(`Total markers created: ${allMarkers.length}`);
        console.log(`Total hotel markers created: ${hotelMarkers.length}`);
        console.log("All markers:", allMarkers);
      }

      // Focus on a specific day (only when clicking sidebar cards)
      function focusDay(dayNumber) {
        currentFocusedDay = dayNumber;

        // Remove active class from all day cards
        document.querySelectorAll(".day-card").forEach((card) => {
          card.classList.remove("active-day");
        });

        // Add active class to clicked day card
        document
          .querySelectorAll(".day-card")
          [dayNumber - 1].classList.add("active-day");

        // Dim all markers and circles
        Object.values(dayMarkers)
          .flat()
          .forEach((marker) =>
            marker.setStyle({ opacity: 0.3, fillOpacity: 0.3 })
          );
        Object.values(dayCircles).forEach((circle) =>
          circle.setStyle({ opacity: 0.2, fillOpacity: 0.05 })
        );

        // Dim all hotel markers
        hotelMarkers.forEach((marker) => marker.setOpacity(0.3));

        // Highlight only selected day markers and circle
        if (dayMarkers[dayNumber]) {
          dayMarkers[dayNumber].forEach((marker) =>
            marker.setStyle({ opacity: 1, fillOpacity: 0.8 })
          );
        }
        if (dayCircles[dayNumber]) {
          dayCircles[dayNumber].setStyle({ opacity: 0.8, fillOpacity: 0.2 });
        }

        // Highlight hotel marker for this day
        const dayData = itinerary.find((d) => d.day === dayNumber);
        if (dayData && hotelLocations[dayData.hotel]) {
          const hotelLoc = hotelLocations[dayData.hotel];
          hotelMarkers.forEach((marker) => {
            const markerLatLng = marker.getLatLng();
            if (
              Math.abs(markerLatLng.lat - hotelLoc.lat) < 0.001 &&
              Math.abs(markerLatLng.lng - hotelLoc.lng) < 0.001
            ) {
              marker.setOpacity(1);
            }
          });
        }

        // Fit map to day's locations
        if (dayMarkers[dayNumber] && dayMarkers[dayNumber].length > 0) {
          const group = new L.featureGroup(dayMarkers[dayNumber]);
          map.fitBounds(group.getBounds().pad(0.1));
        }
      }

      // Show all days
      function showAllDays() {
        currentFocusedDay = null;

        // Remove active class from all day cards
        document.querySelectorAll(".day-card").forEach((card) => {
          card.classList.remove("active-day");
        });

        // Show all markers and circles at full opacity
        Object.values(dayMarkers)
          .flat()
          .forEach((marker) =>
            marker.setStyle({ opacity: 1, fillOpacity: 0.8 })
          );
        Object.values(dayCircles).forEach((circle) =>
          circle.setStyle({ opacity: 0.6, fillOpacity: 0.1 })
        );

        // Show all hotel markers at full opacity
        hotelMarkers.forEach((marker) => marker.setOpacity(1));

        fitToBounds();
      }

      // Fit map to show all locations
      function fitToBounds() {
        if (allMarkers.length > 0) {
          const group = new L.featureGroup(allMarkers);
          map.fitBounds(group.getBounds().pad(0.05));
        }
      }

      // Initialize the app
      createItinerary();

      // Set initial view
      setTimeout(() => {
        fitToBounds();
      }, 100);

      // Mobile functionality - simplified since sidebar is always visible on mobile
      function initializeMobile() {
        const legendToggle = document.getElementById("legendToggle");
        const legend = document.getElementById("legend");
        let legendVisible = false;

        // Legend toggle functionality for mobile
        if (legendToggle) {
          legendToggle.addEventListener("click", function () {
            legendVisible = !legendVisible;

            if (legendVisible) {
              legend.classList.add("mobile-visible");
              legendToggle.classList.add("active");
              legendToggle.textContent = "‚úï Hide";
            } else {
              legend.classList.remove("mobile-visible");
              legendToggle.classList.remove("active");
              legendToggle.textContent = "üìç Legend";
            }
          });
        }

        // Handle window resize to ensure proper layout
        window.addEventListener("resize", function () {
          // Trigger map resize when window is resized
          setTimeout(() => {
            map.invalidateSize();
          }, 100);

          // Reset legend visibility on desktop
          if (window.innerWidth > 768) {
            legend.classList.remove("mobile-visible");
            legendToggle.classList.remove("active");
            legendToggle.textContent = "üìç Legend";
            legendVisible = false;
          }
        });

        // Ensure map resizes properly on mobile
        if (window.innerWidth <= 768) {
          setTimeout(() => {
            map.invalidateSize();
          }, 100);
        }
      }

      // Initialize mobile functionality
      initializeMobile();

      // Add click-away functionality to close popups
      map.on("click", function (e) {
        // Close all open popups when clicking on the map (but not on markers)
        allMarkers.forEach((marker) => {
          if (marker.isPopupOpen()) {
            marker.closePopup();
          }
        });
        hotelMarkers.forEach((marker) => {
          if (marker.isPopupOpen()) {
            marker.closePopup();
          }
        });
      });

      // Prevent popup from closing when clicking on the popup itself
      map.on("popupopen", function (e) {
        const popup = e.popup;
        const popupElement = popup._container;

        if (popupElement) {
          popupElement.addEventListener("click", function (event) {
            event.stopPropagation();
          });
        }
      });
    </script>
  </body>
</html>
